# ğŸ§­ Ğ“Ğ›ĞĞ’Ğ 5. AI-ĞĞ¡Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞĞ¢ Ğ”Ğ›Ğ¯ FPL ANALYTICS PLATFORM

## ğŸ¯ Ğ¦ĞµĞ»ÑŒ Ğ³Ğ»Ğ°Ğ²Ñ‹

Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ **ÑƒĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ°Ñ‚-Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ° Ğ´Ğ»Ñ FPL**, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹:

- ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ½Ğ° ĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ (RU/EN).
- Ğ¡Ğ°Ğ¼ Ñ€ĞµÑˆĞ°ĞµÑ‚, ĞºĞ°ĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· **tools** Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ‘Ğ”/ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ².
- ĞĞµ Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ†Ğ¸Ñ„Ñ€Ñ‹, Ğ° Ğ¾Ğ¿Ğ¸Ñ€Ğ°ĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ñ‚Ğ²Ğ¾ĞµĞ¹ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹.
- Ğ’ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ² Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚ĞµĞº:
  - Next.js 14 (App Router, TypeScript)
  - PostgreSQL (Supabase/Neon)
  - Prisma
  - Vercel (frontend) + ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

Ğ­Ñ‚Ğ¾ Ñ„Ğ°Ğ¹Ğ»-Ñ€Ğ¾Ğ°Ğ´Ğ¼Ğ°Ğ¿ **Ğ´Ğ»Ñ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ° Ğ¸ Ğ´Ğ»Ñ antigravity**:

- Ğ³Ğ´Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ â€” Ğ¾Ğ½ Ğ´ĞµĞ»Ğ°ĞµÑ‚ ĞºĞ¾Ğ´ ÑĞ°Ğ¼,
- Ğ³Ğ´Ğµ Ğ½ÑƒĞ¶Ğ½Ğ° Ñ‚Ğ²Ğ¾Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ â€” ÑÑ‚Ğ¾ ÑĞ²Ğ½Ğ¾ Ğ¿Ğ¾Ğ¼ĞµÑ‡ĞµĞ½Ğ¾.

---

## ğŸ”‘ Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ° Ğ¿Ğ¾ Ñ€Ğ¾Ğ»ÑĞ¼

| ĞœĞµÑ‚ĞºĞ°            | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ                                                                                    |
| ---------------- | ------------------------------------------------------------------------------------------- |
| `ğŸ¤– antigravity` | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ ÑĞ°Ğ¼ (Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ/Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ´, Ñ‚ĞµÑÑ‚Ñ‹, Ğ´Ğ¾ĞºĞ¸). |
| `ğŸ§‘ Ñ‚Ñ‹`          | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ñ€ĞµÑˆĞ¸Ñ‚ÑŒ / Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº.                                        |
| `ğŸ¤ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ½Ğ¾`   | antigravity Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ Ñ‡ĞµÑ€Ğ½Ğ¾Ğ²Ğ¸Ğº, Ñ‚Ñ‹ Ñ€ĞµĞ²ÑŒÑĞ¸ÑˆÑŒ Ğ¸ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑˆÑŒ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ.                             |

---

## 0. ĞŸÑ€ĞµĞ´Ğ¿Ğ¾ÑÑ‹Ğ»ĞºĞ¸ Ğ¸ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ

### 0.1. Ğ§Ñ‚Ğ¾ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¼

- Ğ‘Ğ” Ñ:
  - `players` (700+ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ², xG/xA/xPts, Ñ†ĞµĞ½Ğ°, Ñ„Ğ¾Ñ€Ğ¼Ğ°, Ñ‚Ñ€Ğ°Ğ²Ğ¼Ñ‹, ownership ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ),
  - `fixtures` (ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ Ğ½Ğ° 5+ Ñ‚ÑƒÑ€Ğ¾Ğ²),
  - `user_teams`, `transfers_history` (Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼).
- Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ±ÑĞºĞµĞ½Ğ´ (Next.js API routes), ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ ÑƒĞ¶Ğµ ÑƒĞ¼ĞµĞµÑ‚:
  - Ğ¾Ñ‚Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ² Ğ¸ Ğ¸Ñ… ÑÑ‚Ğ°Ñ‚Ñ‹,
  - Ğ¾Ñ‚Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ,
  - Ğ¾Ñ‚Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ°Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ,
  - Ğ¾Ñ‚Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑÑ„ĞµÑ€Ğ¾Ğ² (rule-based).

> â— Ğ•ÑĞ»Ğ¸ Ñ‡ĞµĞ³Ğ¾-Ñ‚Ğ¾ Ğ½ĞµÑ‚ â€” antigravity Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ñ‡ĞµÑÑ‚Ğ½Ğ¾ Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ² Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:
> "Ğ—Ğ´ĞµÑÑŒ Ğ½ĞµÑ‚ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ¹ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸/Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹, Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ ÑÑ…ĞµĞ¼Ñƒ/ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ"

---

## 1. ĞĞ±Ñ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° AI-Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ°

### 1.1. ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¬                            â”‚
â”‚              Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° ĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CHAT API (/api/chat)                          â”‚
â”‚                                                                 â”‚
â”‚  1. ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ                                         â”‚
â”‚  2. Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ (system prompt + Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ)                â”‚
â”‚  3. Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ LLM Ñ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼ tools                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LLM PROVIDER (Gemini/Groq)                   â”‚
â”‚                                                                 â”‚
â”‚  - ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ                                           â”‚
â”‚  - Ğ ĞµÑˆĞ°ĞµÑ‚, ĞºĞ°ĞºĞ¸Ğµ tools Ğ²Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ                                  â”‚
â”‚  - Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ tool_calls Ğ¸Ğ»Ğ¸ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FPL DOMAIN TOOLS                             â”‚
â”‚                                                                 â”‚
â”‚  - get_player_by_name(name)                                     â”‚
â”‚  - search_replacements(position, maxPrice, ...)                 â”‚
â”‚  - get_user_team(userId)                                        â”‚
â”‚  - analyze_user_team(userId)                                    â”‚
â”‚  - get_fixtures(playerIds, gameweeks)                           â”‚
â”‚  - compare_players(player1, player2)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    POSTGRESQL (Prisma)                          â”‚
â”‚                                                                 â”‚
â”‚  players, fixtures, predictions, user_squads, ...               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2. Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
lib/
â”œâ”€â”€ llm/
â”‚   â”œâ”€â”€ client.ts              # LLM-ĞºĞ»Ğ¸ĞµĞ½Ñ‚ (Gemini/Groq)
â”‚   â”œâ”€â”€ config.ts              # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸ (Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹, Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸)
â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â””â”€â”€ systemPrompt.ts    # System prompt Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ°
â”‚   â””â”€â”€ tools/
â”‚       â”œâ”€â”€ fplTools.ts        # Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ½Ñ‹Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹
â”‚       â””â”€â”€ definitions.ts     # ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ tools Ğ´Ğ»Ñ LLM
â”‚
app/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ chat/
â”‚       â””â”€â”€ route.ts           # Chat API endpoint
â””â”€â”€ chat/
    â””â”€â”€ page.tsx               # UI Ñ‡Ğ°Ñ‚-ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹

docs/
â”œâ”€â”€ 05_llm_provider_decision.md    # Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñƒ
â””â”€â”€ 05_fpl_tools.md                # Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ tools
```

---

## 2. Ğ¤ĞĞ—Ğ 1 â€” Ğ’Ñ‹Ğ±Ğ¾Ñ€ LLM-Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° Ğ¸ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚

### 2.1. Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñƒ `ğŸ§‘ Ñ‚Ñ‹`

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ LLM.

| ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€       | ĞœĞ¾Ğ´ĞµĞ»ÑŒ           | Function Calling     | Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ |
| --------------- | ---------------- | -------------------- | ---------------- |
| **Gemini**      | Gemini 2.0 Flash | âœ… Ğ”Ğ°                | 1,500 req/day    |
| **Groq**        | Llama 3.1 70B    | âœ… Ğ”Ğ°                | 14,400 req/day   |
| **Together AI** | Llama 3.1        | âœ… Ğ”Ğ°                | $25 ĞºÑ€ĞµĞ´Ğ¸Ñ‚Ğ¾Ğ²     |
| **OpenRouter**  | Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ           | âœ… Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ | Pay-per-use      |

**Ğ¢Ğ²Ğ¾Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ:**

1. Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ.
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ» `docs/05_llm_provider_decision.md` Ñ ĞºÑ€Ğ°Ñ‚ĞºĞ¸Ğ¼ Ğ¾Ğ±Ğ¾ÑĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼.
3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² `.env`:
   ```env
   LLM_PROVIDER=gemini  # Ğ¸Ğ»Ğ¸ groq
   LLM_MODEL=gemini-2.0-flash-exp
   LLM_API_KEY=your_api_key
   ```

---

### 2.2. Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ LLM-ĞºĞ»Ğ¸ĞµĞ½Ñ‚ `ğŸ¤– antigravity`

**Ğ¦ĞµĞ»ÑŒ:** ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ¹ `callLlm`, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹:

- ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ API;
- Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ messages + tools;
- Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑÑ‚ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ° Ğ¸ ÑĞ¿Ğ¸ÑĞ¾Ğº tool-calls.

**Ğ¤Ğ°Ğ¹Ğ»:** `lib/llm/client.ts`

```typescript
// lib/llm/client.ts

export type LlmRole = "system" | "user" | "assistant" | "tool";

export type LlmMessage =
  | { role: "system"; content: string }
  | { role: "user"; content: string }
  | { role: "assistant"; content: string }
  | { role: "tool"; name: string; content: string };

export interface LlmToolDefinition {
  name: string;
  description: string;
  inputSchema: Record<string, unknown>; // JSON Schema
}

export interface LlmToolCall {
  id: string;
  name: string;
  arguments: Record<string, unknown>;
}

export interface LlmCallOptions {
  model?: string;
  tools?: LlmToolDefinition[];
  toolChoice?: "auto" | "none" | { type: "tool"; name: string };
  temperature?: number;
}

export interface LlmCallResult {
  message: string | null;
  toolCalls: LlmToolCall[];
}

export async function callLlm(
  messages: LlmMessage[],
  options: LlmCallOptions
): Promise<LlmCallResult> {
  const provider = process.env.LLM_PROVIDER;

  if (provider === "gemini") {
    return callGemini(messages, options);
  } else if (provider === "groq") {
    return callGroq(messages, options);
  }

  throw new Error(`Unknown LLM provider: ${provider}`);
}

async function callGemini(
  messages: LlmMessage[],
  options: LlmCallOptions
): Promise<LlmCallResult> {
  // TODO: Implement Gemini API call
  throw new Error("Not implemented");
}

async function callGroq(
  messages: LlmMessage[],
  options: LlmCallOptions
): Promise<LlmCallResult> {
  // TODO: Implement Groq API call
  throw new Error("Not implemented");
}
```

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³:** `lib/llm/config.ts`

```typescript
export const LLM_CONFIG = {
  maxTokensPerCall: 2000,
  maxToolCallsPerRequest: 3,
  maxMessagesHistory: 15,
  defaultTemperature: 0.7,
};
```

---

## 3. Ğ¤ĞĞ—Ğ 2 â€” FPL Domain Tools

### 3.1. ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ¾Ğ² `ğŸ¤ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ½Ğ¾`

**Ğ¤Ğ°Ğ¹Ğ»:** `lib/llm/tools/fplTools.ts`

```typescript
// lib/llm/tools/fplTools.ts

export type FplPosition = "GKP" | "DEF" | "MID" | "FWD";

export interface PlayerSummary {
  id: number;
  name: string;
  team: string;
  position: FplPosition;
  price: number;
  xPtsNext5: number;
  form: number;
  ownership?: number;
  isInjured: boolean;
  fixtures?: FixtureSummary[];
}

export interface FixtureSummary {
  gameweek: number;
  opponent: string;
  isHome: boolean;
  fdr: number;
}

export interface TeamAnalysis {
  healthScore: number;
  problems: string[];
  suggestions: string[];
  totalXPtsNext5: number;
}

// === Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ ===

export async function getPlayerByName(
  name: string
): Promise<PlayerSummary | null> {
  // ĞŸĞ¾Ğ¸ÑĞº Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸ (fuzzy match)
  throw new Error("Not implemented");
}

export async function getPlayerById(id: number): Promise<PlayerSummary | null> {
  // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° Ğ¿Ğ¾ ID
  throw new Error("Not implemented");
}

export async function searchReplacements(params: {
  position?: FplPosition;
  maxPrice?: number;
  minXPts?: number;
  maxOwnership?: number;
  limit?: number;
}): Promise<PlayerSummary[]> {
  // ĞĞ°Ğ¹Ñ‚Ğ¸ ĞºĞ°Ğ½Ğ´Ğ¸Ğ´Ğ°Ñ‚Ğ¾Ğ² Ğ½Ğ° Ğ·Ğ°Ğ¼ĞµĞ½Ñƒ
  throw new Error("Not implemented");
}

export async function comparePlayers(
  player1Id: number,
  player2Id: number
): Promise<{ player1: PlayerSummary; player2: PlayerSummary }> {
  // Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ğ´Ğ²ÑƒÑ… Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²
  throw new Error("Not implemented");
}

export async function getUserTeam(userId: string): Promise<PlayerSummary[]> {
  // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ°Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  throw new Error("Not implemented");
}

export async function analyzeUserTeam(userId: string): Promise<TeamAnalysis> {
  // ĞĞ½Ğ°Ğ»Ğ¸Ğ· ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  throw new Error("Not implemented");
}

export async function getFixturesForPlayers(
  playerIds: number[],
  gameweeks: number
): Promise<Record<number, FixtureSummary[]>> {
  // ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²
  throw new Error("Not implemented");
}
```

---

### 3.2. ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ tools Ğ´Ğ»Ñ LLM `ğŸ¤– antigravity`

**Ğ¤Ğ°Ğ¹Ğ»:** `lib/llm/tools/definitions.ts`

```typescript
// lib/llm/tools/definitions.ts

import { z } from "zod";
import * as fplTools from "./fplTools";

export interface ToolDefinition {
  name: string;
  description: string;
  inputSchema: z.ZodType<unknown>;
  execute: (args: unknown) => Promise<unknown>;
}

export const tools: ToolDefinition[] = [
  {
    name: "get_player_by_name",
    description:
      "ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° FPL Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµÑ‚ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°.",
    inputSchema: z.object({
      name: z.string().describe("Ğ˜Ğ¼Ñ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°: Salah, Isak, Palmer Ğ¸ Ñ‚.Ğ´."),
    }),
    execute: async (args) => {
      const { name } = args as { name: string };
      return fplTools.getPlayerByName(name);
    },
  },

  {
    name: "search_replacements",
    description:
      "ĞĞ°Ğ¹Ñ‚Ğ¸ ĞºĞ°Ğ½Ğ´Ğ¸Ğ´Ğ°Ñ‚Ğ¾Ğ² Ğ½Ğ° Ğ·Ğ°Ğ¼ĞµĞ½Ñƒ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¸Ñ‰ĞµÑ‚ Ğ·Ğ°Ğ¼ĞµĞ½Ñƒ Ğ¸Ğ»Ğ¸ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ 'ĞºĞ¾Ğ³Ğ¾ Ğ²Ğ·ÑÑ‚ÑŒ'.",
    inputSchema: z.object({
      position: z.enum(["GKP", "DEF", "MID", "FWD"]).optional(),
      maxPrice: z.number().optional().describe("ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ†ĞµĞ½Ğ° Ğ² Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½Ğ°Ñ…"),
      minXPts: z.number().optional().describe("ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ xPts Ğ½Ğ° 5 Ñ‚ÑƒÑ€Ğ¾Ğ²"),
      maxOwnership: z
        .number()
        .optional()
        .describe("ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ % Ğ²Ğ»Ğ°Ğ´ĞµĞ½Ğ¸Ñ (Ğ´Ğ»Ñ Ğ´Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ğ°Ğ»Ğ¾Ğ²)"),
      limit: z.number().optional().default(5),
    }),
    execute: async (args) => {
      return fplTools.searchReplacements(
        args as Parameters<typeof fplTools.searchReplacements>[0]
      );
    },
  },

  {
    name: "compare_players",
    description:
      "Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ğ´Ğ²ÑƒÑ… Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ². Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ 'X Ğ¸Ğ»Ğ¸ Y', 'ÑÑ€Ğ°Ğ²Ğ½Ğ¸ X Ğ¸ Y'.",
    inputSchema: z.object({
      player1Name: z.string(),
      player2Name: z.string(),
    }),
    execute: async (args) => {
      const { player1Name, player2Name } = args as {
        player1Name: string;
        player2Name: string;
      };
      const p1 = await fplTools.getPlayerByName(player1Name);
      const p2 = await fplTools.getPlayerByName(player2Name);
      if (!p1 || !p2) return { error: "ĞĞ´Ğ¸Ğ½ Ğ¸Ğ· Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ² Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½" };
      return fplTools.comparePlayers(p1.id, p2.id);
    },
  },

  {
    name: "get_user_team",
    description: "ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑĞ¾ÑÑ‚Ğ°Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² FPL.",
    inputSchema: z.object({
      userId: z.string().describe("FPL ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"),
    }),
    execute: async (args) => {
      const { userId } = args as { userId: string };
      return fplTools.getUserTeam(userId);
    },
  },

  {
    name: "analyze_user_team",
    description:
      "ĞŸÑ€Ğ¾Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ: Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹, Ğ´Ğ°Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸.",
    inputSchema: z.object({
      userId: z.string().describe("FPL ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"),
    }),
    execute: async (args) => {
      const { userId } = args as { userId: string };
      return fplTools.analyzeUserTeam(userId);
    },
  },

  {
    name: "get_fixtures",
    description: "ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ Ğ¼Ğ°Ñ‚Ñ‡ĞµĞ¹ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ² Ğ½Ğ° Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğµ N Ñ‚ÑƒÑ€Ğ¾Ğ².",
    inputSchema: z.object({
      playerNames: z.array(z.string()).describe("Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ¼Ñ‘Ğ½ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²"),
      gameweeks: z.number().default(5).describe("ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚ÑƒÑ€Ğ¾Ğ²"),
    }),
    execute: async (args) => {
      const { playerNames, gameweeks } = args as {
        playerNames: string[];
        gameweeks: number;
      };
      const players = await Promise.all(
        playerNames.map((n) => fplTools.getPlayerByName(n))
      );
      const ids = players.filter(Boolean).map((p) => p!.id);
      return fplTools.getFixturesForPlayers(ids, gameweeks);
    },
  },
];

// ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ»Ñ LLM
export function getToolDefinitionsForLlm() {
  return tools.map((t) => ({
    name: t.name,
    description: t.description,
    inputSchema: JSON.parse(JSON.stringify(t.inputSchema)), // zod to JSON schema
  }));
}

// Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ tool call
export async function executeTool(
  name: string,
  args: unknown
): Promise<unknown> {
  const tool = tools.find((t) => t.name === name);
  if (!tool) throw new Error(`Unknown tool: ${name}`);
  return tool.execute(args);
}
```

---

## 4. Ğ¤ĞĞ—Ğ 3 â€” System Prompt

### 4.1. System Prompt Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ° `ğŸ¤ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ½Ğ¾`

**Ğ¤Ğ°Ğ¹Ğ»:** `lib/llm/prompts/systemPrompt.ts`

```typescript
export const SYSTEM_PROMPT = `
Ğ¢Ñ‹ â€” Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚ Ğ¿Ğ¾ Fantasy Premier League (FPL) Ğ´Ğ»Ñ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¹ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹.

## Ğ¢Ğ²Ğ¾Ğ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸
- ĞÑ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¾Ğ± Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°Ñ…, ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ñ…, ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğµ
- Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²
- ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ°Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
- Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ñ€Ğ°Ğ½ÑÑ„ĞµÑ€Ñ‹ Ğ¸ Ğ·Ğ°Ğ¼ĞµĞ½Ñ‹
- Ğ˜ÑĞºĞ°Ñ‚ÑŒ Ğ´Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ğ°Ğ»Ğ¾Ğ²

## ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ
- âŒ ĞĞ• Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ğ¹ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ. Ğ’ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ±ĞµÑ€Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· tools.
- âŒ Ğ•ÑĞ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½ĞµÑ‚ â€” Ñ‡ĞµÑÑ‚Ğ½Ğ¾ ÑĞºĞ°Ğ¶Ğ¸ Ğ¾Ğ± ÑÑ‚Ğ¾Ğ¼.
- âŒ ĞĞµ Ğ´Ğ°Ğ²Ğ°Ğ¹ Ñ„Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ².

## ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ‚Ñ‹ Ğ·Ğ½Ğ°ĞµÑˆÑŒ
- **xPts** â€” Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ¾Ñ‡ĞºĞ¾Ğ² Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ xG/xA
- **EO (Effective Ownership)** â€” % Ğ²Ğ»Ğ°Ğ´ĞµĞ½Ğ¸Ñ ÑÑ€ĞµĞ´Ğ¸ Ñ‚Ğ¾Ğ¿-Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ²
- **FDR** â€” ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ (1-5, Ğ³Ğ´Ğµ 1 â€” Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹)
- **Ğ¤Ğ¾Ñ€Ğ¼Ğ°** â€” ÑÑ€ĞµĞ´Ğ½Ğ¸Ğµ Ğ¾Ñ‡ĞºĞ¸ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 5 Ñ‚ÑƒÑ€Ğ¾Ğ²

## ĞšĞ°Ğº Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ
1. Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¸ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ tools Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
2. ĞŸÑ€Ğ¾Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
3. Ğ”Ğ°Ğ¹ ĞºÑ€Ğ°Ñ‚ĞºĞ¸Ğ¹, ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚
4. Ğ•ÑĞ»Ğ¸ ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµÑˆÑŒ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ² â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ

## ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¸ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ
- "ĞšĞ¾Ğ³Ğ¾ Ğ²Ğ·ÑÑ‚ÑŒ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ˜ÑĞ°ĞºĞ°?" â†’ get_player_by_name(Isak) + search_replacements
- "Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸ Ğ¡Ğ°Ğ»Ğ°Ñ…Ğ° Ğ¸ Ğ¡Ğ°ĞºĞ°" â†’ compare_players
- "Ğ Ğ°Ğ·Ğ±ĞµÑ€Ğ¸ Ğ¼Ğ¾Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ" â†’ get_user_team + analyze_user_team
- "Ğ¢Ğ¾Ğ¿ Ğ´Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ğ°Ğ»Ñ‹" â†’ search_replacements(maxOwnership: 10)

ĞÑ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ Ğ¸Ğ»Ğ¸ Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¾Ğ¼ â€” Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ ÑĞ·Ñ‹ĞºĞ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°.
`.trim();
```

---

## 5. Ğ¤ĞĞ—Ğ 4 â€” Chat API

### 5.1. Chat API endpoint `ğŸ¤– antigravity`

**Ğ¤Ğ°Ğ¹Ğ»:** `app/api/chat/route.ts`

```typescript
// app/api/chat/route.ts

import { NextRequest, NextResponse } from "next/server";
import { callLlm, LlmMessage } from "@/lib/llm/client";
import { SYSTEM_PROMPT } from "@/lib/llm/prompts/systemPrompt";
import {
  getToolDefinitionsForLlm,
  executeTool,
} from "@/lib/llm/tools/definitions";
import { LLM_CONFIG } from "@/lib/llm/config";

export async function POST(req: NextRequest) {
  try {
    const { messages, userId } = await req.json();

    // Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
    const llmMessages: LlmMessage[] = [
      { role: "system", content: SYSTEM_PROMPT },
      ...messages.slice(-LLM_CONFIG.maxMessagesHistory),
    ];

    // ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ² LLM â€” Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ tool calls
    let result = await callLlm(llmMessages, {
      tools: getToolDefinitionsForLlm(),
      toolChoice: "auto",
    });

    // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° tool calls (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ N Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹)
    let iterations = 0;
    while (
      result.toolCalls.length > 0 &&
      iterations < LLM_CONFIG.maxToolCallsPerRequest
    ) {
      iterations++;

      // Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ²ÑĞµ tool calls
      for (const toolCall of result.toolCalls) {
        const toolResult = await executeTool(toolCall.name, toolCall.arguments);
        llmMessages.push({
          role: "tool",
          name: toolCall.name,
          content: JSON.stringify(toolResult),
        });
      }

      // Ğ¡Ğ½Ğ¾Ğ²Ğ° Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ LLM Ğ´Ğ»Ñ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°
      result = await callLlm(llmMessages, {
        tools: getToolDefinitionsForLlm(),
        toolChoice: "auto",
      });
    }

    return NextResponse.json({
      message: result.message,
      toolsUsed: iterations > 0,
    });
  } catch (error) {
    console.error("Chat API error:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}
```

---

## 6. Ğ¤ĞĞ—Ğ 5 â€” Frontend Ñ‡Ğ°Ñ‚

### 6.1. Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ñ‡Ğ°Ñ‚Ğ° `ğŸ¤– antigravity`

**Ğ¤Ğ°Ğ¹Ğ»:** `app/chat/page.tsx`

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ñ:

- ĞŸĞ¾Ğ»ĞµĞ¼ Ğ²Ğ²Ğ¾Ğ´Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸ĞµĞ¹ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ° (user vs assistant)
- Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
- ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ĞµĞ¼ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²)

---

## 7. Ğ¤ĞĞ—Ğ 6 â€” Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ²

### 7.1. ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸ `ğŸ¤ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ½Ğ¾`

| Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹       | ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°                                   | ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğµ tools                         |
| -------------- | ------------------------------------------------ | --------------------------------------- |
| Ğ—Ğ°Ğ¼ĞµĞ½Ğ° Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°  | "ĞšĞ¾Ğ³Ğ¾ Ğ²Ğ·ÑÑ‚ÑŒ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ñ‚Ñ€Ğ°Ğ²Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ˜ÑĞ°ĞºĞ° Ğ´Ğ¾ 9Ğ¼?" | get_player_by_name, search_replacements |
| Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ      | "Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸ Ğ¡Ğ°Ğ»Ğ°Ñ…Ğ° Ğ¸ Ğ¡Ğ°ĞºĞ° Ğ½Ğ° 5 Ñ‚ÑƒÑ€Ğ¾Ğ²"                | compare_players, get_fixtures           |
| ĞĞ½Ğ°Ğ»Ğ¸Ğ· ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ | "Ğ Ğ°Ğ·Ğ±ĞµÑ€Ğ¸ Ğ¼Ğ¾Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ"                            | get_user_team, analyze_user_team        |
| Ğ”Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ğ°Ğ»Ñ‹  | "Ğ¢Ğ¾Ğ¿ Ğ´Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ğ°Ğ»Ñ‹ ÑÑ€ĞµĞ´Ğ¸ Ñ„Ğ¾Ñ€Ğ²Ğ°Ñ€Ğ´Ğ¾Ğ²"              | search_replacements(maxOwnership: 10)   |

---

## 8. ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ "Ğ“ĞĞ¢ĞĞ’Ğ"

Ğ“Ğ»Ğ°Ğ²Ğ° 5 ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ğ¾Ğ¹, ĞµÑĞ»Ğ¸:

- âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ LLM-Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ Ğ¸ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ (`lib/llm/client.ts`)
- âœ… Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ½Ñ‹Ğµ FPL tools (`fplTools.ts`) Ğ¸ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹ Ğ´Ğ»Ñ LLM (`definitions.ts`)
- âœ… Ğ•ÑÑ‚ÑŒ SYSTEM_PROMPT Ñ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼ Ñ€Ğ¾Ğ»Ğ¸ Ğ¸ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğ¹
- âœ… Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ endpoint `/api/chat` Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ function calling
- âœ… Ğ•ÑÑ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° `/chat` Ñ UI
- âœ… Ğ¢Ñ€Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ñ… ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ Ğ´Ğ°ÑÑ‚ Ğ²Ğ¼ĞµĞ½ÑĞµĞ¼Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
- âœ… Ğ•ÑÑ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ: `docs/05_llm_provider_decision.md`, `docs/05_fpl_tools.md`

---

## 9. Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

- [ ] **Ğ¤ĞĞ—Ğ 1:** Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° + Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚
- [ ] **Ğ¤ĞĞ—Ğ 2:** FPL Domain Tools (Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹ + Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ)
- [ ] **Ğ¤ĞĞ—Ğ 3:** System Prompt
- [ ] **Ğ¤ĞĞ—Ğ 4:** Chat API endpoint
- [ ] **Ğ¤ĞĞ—Ğ 5:** Frontend Ñ‡Ğ°Ñ‚
- [ ] **Ğ¤ĞĞ—Ğ 6:** Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ²
